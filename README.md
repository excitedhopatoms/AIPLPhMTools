# PKU-AIPL 光子器件设计代码库

- *version:* **Gdsfactory-v9,Tools-v1n**

## 概述
本代码库包含了一系列用于光子器件设计的Python代码。这些代码利用了 `gdsfactory` 库，用于创建、操作和优化光子集成电路（PIC）中的各种组件。

## 文件结构与功能

### 1. `BasicDefine.py`
此文件包含了多个基础组件的定义和辅助函数，用于创建和操作光子器件。

#### 主要功能
- **基本组件创建**
    - `GfCStraight`：创建一个直线波导组件，可指定长度、宽度和层。
    - `GfCBendEuler`：创建一个欧拉弯曲波导组件，其弯曲半径可变。
    - `TaperRsoa`：创建一个用于RSOA（半导体光放大器）的锥形波导组件。
    - `Crossing_taper`：创建一个带有锥形过渡的交叉波导组件。
    - `OffsetRamp`：创建一个具有偏移的斜坡组件。
    - `TWQRcode`：创建一个包含二维码的组件，用于标记或识别。
    - `cir2end`：创建一个从圆形到端部的过渡组件。

- **组件操作函数**
    - `remove_layer`：从组件中删除指定层的所有多边形。
    - `GetFromLayer`：从组件中提取指定层的多边形并创建一个新组件。
    - `shift_component`：将组件中的所有元素沿x和y方向移动指定的距离。

- **路径生成函数**
    - `euler_Bend_Half`：生成一个从弯曲到直线的绝热过渡欧拉弯曲路径。
    - `euler_Bend_Part`：生成一个曲率从 `radius1` 过渡到 `radius2` 的欧拉弯曲路径。

- **标签添加函数**
    - `add_labels_to_ports`：为组件的端口添加标签，方便识别和调试。

### 2. `CouplerMZI.py`
此文件主要用于创建和操作光子耦合器和马赫 - 曾德尔干涉仪（MZI）结构。

#### 主要功能
- **耦合器创建**
    - `PulleyCoupler2X2`：创建一个2x2的Pulley定向耦合器，可指定宽度、角度、半径和间隙等参数。

- **MZI结构创建**
    - `PMZI`：创建一个Pulley耦合的MZI结构，包含输入、输出端口和可选的加热器。

### 3. `Boomerang.py`
此文件用于创建一个环形三角回旋镖（Ring Tri Boomerang）结构，该结构由多个回旋镖组件组成。

#### 主要功能
- **环形三角回旋镖结构创建**
    - `RingTriBoomerang`：创建一个环形三角回旋镖结构，包含输入、输出端口和可选的加热器。该结构由三个回旋镖组件连接而成，并添加了输入、直通、添加和下降端口。
    - 
### `4. DBR.py`

此文件用于创建分布式布拉格反射器（DBR）结构，支持通过固定参数或从 CSV 文件读取参数来生成 DBR 组件，并且可以选择是否添加加热器。

#### 主要功能
- **分布式布拉格反射器创建**
    - `DBR`：根据给定的波导宽度、长度、周期数等参数创建一个分布式布拉格反射器，支持渐变长度模式和固定长度模式，可选择是否添加加热器。
    - `DBRFromCsv`：从 CSV 文件中读取波导的宽度和长度信息，创建分布式布拉格反射器，同样可选择是否添加加热器。
    - `DBRFromCsvOffset`：在从 CSV 文件读取参数的基础上，对波导宽度进行偏移处理，再创建分布式布拉格反射器，也可选择是否添加加热器。
### `5. ELE.py`

此文件用于创建多种电极相关的组件，包括开放焊盘、偏移斜坡和GSG电极，支持不同的参数配置以满足多样化的设计需求。

#### 主要功能
- **开放焊盘创建**
    - `OpenPad`：创建一个开放焊盘组件，包含一个中心焊盘和外围的电极层。可通过指定中心焊盘的宽度、电极层与中心焊盘的间距、中心焊盘和电极层的层定义来生成组件。组件具有四个端口，分别为左侧、右侧、上侧和下侧端口。

- **偏移斜坡创建**
    - `OffsetRamp`：创建一个偏移斜坡组件，用于连接不同宽度的波导。可设置斜坡的长度、起始端和终止端的宽度、输出端中心相对于输入端中心的偏移量以及斜坡的层定义。组件具有输入端和输出端两个端口。

- **GSG电极创建**
    - `GSGELE`：创建一个GSG电极组件，支持焊盘和双焊盘配置。可指定G电极和S电极的宽度、G电极与S电极之间的间距、电极的长度，还能选择是否添加焊盘或双焊盘，以及设置焊盘的相关参数（如间距、宽度、外围电极层间距等）和层定义。组件具有多个端口，包括输入输出端口和G、S电极的输入输出端口。

### `6. ExtCav.py`

此文件用于创建不同类型的外部腔（External Cavity）结构，主要应用于光学器件设计，提供了多种经过验证的设计方案，可根据不同的需求和材料（如 SOI、SiN 等）进行选择，同时支持对结构的多个参数进行灵活配置。

#### 主要功能
- **外部腔结构创建**
    - `ExternalCavitySOI`：创建基于绝缘体上硅（SOI）材料的外部腔结构。可通过设置环半径、波导宽度、长度、间隙等参数来定制该结构，并且可以选择是否添加加热器。
    - `ExternalCavitySiN`：为氮化硅（SiN）材料并带有加热器的情况设计的外部腔结构。相较于 `ExternalCavitySOI`，增加了一些特定参数，如欧拉半径、MZI 环半径等，以适应 SiN 材料的特性，同样支持加热器的添加。
    - `ExternalCavitySiNH2`：另一种适用于 SiN 材料加加热器的外部腔结构设计。该结构在参数设置上与 `ExternalCavitySiN` 有部分差异，对环与耦合器之间的长度、总线加热器长度等进行了特殊设置。
    - `ExternalCavitySiNH2_1`：与 `ExternalCavitySiNH2` 类似，也是针对 SiN 材料加加热器的设计，但环与环之间采用弯曲连接方式，可根据实际需求调整相关参数。
    - `ExternalCavity2`：创建一个三环外部腔激光器（tri ring ecl）结构。该结构具有特定的角度和长度参数设置，可用于特定的光学应用场景。
    - `ExternalCavity3`：一种风险设计的外部腔结构，在参数设置上与其他结构有所不同，如路由层的选择等，可用于探索新的设计可能性。

# 代码库说明文档

## 概述
本代码库包含多个文件，主要用于创建光子集成领域的各种组件，如单环隔离器、加热器、特定结构的反射器以及分布式布拉格反射器（DBR）等。每个文件实现了不同的功能，下面将对每个文件进行详细介绍。

## 文件功能介绍

### `7. Isolator.py`
此文件用于创建单环隔离器相关的组件，包含三种不同类型的单环隔离器和一个环与隔离器的组合结构。

#### 主要功能
- **单环隔离器创建**
    - `SingleRingIsolator0`：创建一个包含 ADD - DROP 环和监测器的单环隔离器，通过设置环的半径、宽度、耦合角度等参数来定制结构。
    - `SingleRingIsolator1`：在 `SingleRingIsolator0` 的基础上增加了监测功能，同样可以通过多个参数进行结构定制。
    - `RingAndIsolator0`：创建一个环与单环隔离器的组合结构，用于梳状滤波器和 ADD - DROP 环的组合，支持参数化定制。

### `8. Heater.py`
该文件实现了不同类型的加热器组件，包括蛇形加热器、多种不同布局的加热器，以及通孔阵列的生成。

#### 主要功能
- **加热器创建**
    - `SnakeHeater`：创建蛇形加热器，可通过设置加热器宽度、波导宽度、间隙等参数进行定制。
    - `DifferentHeater`：根据不同的 `TypeHeater` 参数，创建不同类型的加热器，如默认加热器、蛇形加热器、侧边加热器、两侧边加热器和分割加热器等。
    - `ViaArray`：在给定组件内部高效生成通孔阵列，可设置通孔宽度、间距、包围距离等参数。

### `9. memyshev.py`
此文件实现了一种特定的反射器结构，即双环 Memyshev 反射器。

#### 主要功能
- **双环 Memyshev 反射器创建**
    - `DoubleRingMemyshev`：创建一个双环 Memyshev 反射器，通过设置环的半径、宽度、耦合角度、加热器参数等，实现结构的定制。

### `10. MultiRing.py`

此文件用于创建多种复杂的多环形谐振器结构，支持加热电极、不同连接方式及耦合配置，适用于光子集成电路中的滤波、传感等应用。

---

#### 主要功能

##### 10.1. **双环形谐振器结构**
- **`DoubleRingPulley`**  
  创建双环形谐振器组件，支持直连或弯曲连接方式，可选蛇形/侧边加热器。  
  **关键参数**：  
  - `WidthRing`: 环形波导宽度（μm）
  - `LengthR2R`: 环间连接长度（μm）
  - `TypeHeater`: 加热器类型（`"default"`, `"snake"`）
  - `IsHeat`: 是否包含加热电极  
  **端口**：`o1`（输入）, `R1A`（Add端口）, `R1HeatIn`（加热输入）等。

- **`DoubleRingPulley2HSn`**  
  带蛇形加热器的双环形谐振器，继承自`DoubleRingPulley`，专为高效热调谐设计。

- **`DoubleRingPulley2_1HSn`**  
  环形间采用圆形弯曲连接的双环形结构，集成蛇形加热器，适用于紧凑布局。

##### 10.2. **三环形谐振器与交叉波导**
- **`ADRAPRADR`**  
  创建包含三个环形谐振器和交叉波导的复杂结构，支持方形布局和加热配置。  
  **关键参数**：  
  - `RadiusCrossBend`: 交叉波导弯曲半径（μm）
  - `IsSquare`: 是否使用方形布局  
  **端口**：`r1Th`（Through端口）, `co2`（交叉输出）等。

##### 10.3. **双跑道形谐振器**
- **`DoubleRaceTrackPulley`**  
  创建双跑道形谐振器，支持同侧/异侧连接，适用于长距离耦合场景。  
  **关键参数**：  
  - `LengthRun`: 直线部分长度（μm）
  - `IsSameSide`: 是否同侧连接  

##### 10.4. **耦合腔结构**
- **`CoupleRingDRT1`**  
  支持不同尺寸环形谐振器的耦合，可配置独立加热电极，适用于高精度传感。  
  **关键参数**：  
  - `GapRR`: 环间间隙（μm）
  - `TypeHeaterR1/R2`: 各环加热器类型  

---

### `11. RaceTrack.py`

此文件用于创建跑道形谐振器及其变体，支持锥形耦合、加热电极集成及热隔离刻蚀层。

---

#### 主要功能

##### 11.1. **基础跑道形谐振器**
- **`RaceTrackPulley`**  
  标准跑道形谐振器，支持输入/输出端口和Add-Drop端口。  
  **关键参数**：  
  - `LengthRun`: 直线部分长度（μm）
  - `AngleCouple`: 耦合角度（°）

##### 11.2. **高级跑道形结构**
- **`TaperRaceTrackPulley`**  
  带锥形耦合的跑道形谐振器，优化模式匹配，减少插入损耗。  
  **关键参数**：  
  - `LengthTaper`: 锥形部分长度（μm）

- **`RaceTrackPulley2HS`**  
  集成加热电极的跑道形结构，支持蛇形/侧边加热器，适用于热光调制。  
  **关键参数**：  
  - `WidthHeat`: 加热电极宽度（μm）
  - `DeltaHeat`: 加热电极偏移量（μm）

---

### `12.Ring.py`

此文件提供多种环形谐振器设计，涵盖不同耦合类型、加热配置及电子线路集成。

---

#### 主要功能

##### 12.1. **通用环形谐振器**
- **`RingPulleyT1`**  
  支持默认/蛇形/双侧加热器，可调耦合间隙与角度，适用于通用滤波场景。  
  **关键参数**：  
  - `TypeHeater`: 加热器类型（`"default"`, `"snake"`, `"bothside"`）
  - `GapHeat`: 加热电极间隙（μm）

##### 12.2. **特殊耦合结构**
- **`RingPulley1DC`**  
  上下耦合器参数独立配置的双耦合环形谐振器，支持非对称响应设计。

- **`RingFinger`**  
  山形环形结构，结合弧形与直线波导，适用于高Q值谐振腔。

##### 12.3. **电子集成环形器**
- **`RingPulley2ES`**  
  集成电子线路的环形谐振器，支持电热调谐与信号路由。  
  **关键参数**：  
  - `WidthEle`: 电子线路宽度（μm）

##### 12.4. **加热器模块**
- **`DifferentHeater_local`**  
  为环形谐振器提供多种加热电极设计，包括蛇形、双侧和分裂式加热器。
### `TCCoupledCavity.py`

此文件用于创建耦合环形谐振腔结构，支持多种环形拓扑（如单环、双环、三环）和加热器配置，提供灵活的几何参数控制。

#### 主要功能
- **多环耦合腔体结构**
  - `TCRingBoomerangT1`：创建单环形谐振腔，支持输入/输出锥形波导、加热器及多端口配置，可控制耦合间距和加热器类型。
  - `TCRingDouBoomerangT1`：创建双环形耦合谐振腔，支持更复杂的耦合路径和垂直/水平布局参数调整。
  - `TCRingTriBoomerangT1`：创建三环形级联谐振腔，支持多段耦合桥和分层加热器设计。
  - `TCCoupleRingDRT1`：双环直接耦合结构，支持独立控制两个环的半径、宽度和加热器参数。

---

### `13. TCRaceTrack.py`

此文件用于设计跑道型（RaceTrack）谐振腔及其变体，支持直线耦合段、加热器集成和多种输入/输出路径配置。

#### 主要功能
- **跑道型谐振腔**
  - `TCRaceTrack`：基础跑道型谐振腔，支持欧拉弯曲耦合和锥形波导过渡。
  - `TCRaceTrack2_1`/`TCRaceTrack2_2`/`TCRaceTrack2_3`：不同耦合方向的变体（水平/垂直/混合），支持长直波导段和紧凑布局。
  - `TCTaperRaceTrack`：带锥形耦合段的跑道型结构，优化模式匹配和插入损耗。
  - `TCRaceTrack2_3h`：集成蛇形加热器的跑道型谐振腔，支持热调谐和层间路由。

---

### `14. TCRing.py`

此文件提供通用环形谐振腔组件库，涵盖多种耦合方式（角度/长度/方向）、加热器类型和端口配置。

#### 主要功能
- **基础环形谐振腔**
  - `TCRing`：标准环形谐振腔，支持欧拉弯曲耦合、加热器和Add/Drop端口。
  - `TCRing1_2`：支持四端口配置（Input/Through/Add/Drop），适用于滤波器设计。
  - `TCRing1_3`：简化版单输入/输出环形结构，无加热器，适合低损耗场景。
  
- **高级功能扩展**
  - `TCRing1_3hs`：侧边加热器版本，支持热调谐和独立电极层。
  - `TCRingDCouple`：直接耦合环形结构，内置耦合段加热器和路由优化。
  - `TCRingT1`/`TCRingT2`：支持锥形波导位置动态调整（弯曲前/后/中间），适配复杂布局。

- **特殊拓扑结构**
  - `TCFingerRing1`：手指型耦合环形腔，支持大角度耦合和紧凑连接。
  - `TCRing3`/`TCRing4`：超大角度耦合结构（>90°或>180°），适用于高密度集成。

---
## 使用示例

### 创建直线波导
```python
import gdsfactory as gf
from FabBasic_hjh.BasicDefine import GfCStraight

# 创建一个长度为20um，宽度为1um的直线波导
straight_waveguide = GfCStraight(length=20, width=1)
straight_waveguide.show()  # 显示波导
```

### 创建Pulley耦合MZI结构
```python
from FabBasic_hjh.CouplerMZI import PMZI

# 创建一个Pulley耦合MZI结构
mzi = PMZI()
mzi.show()  # 显示MZI结构
```

### 创建环形三角回旋镖结构
```python
from FabBasic_hjh.Boomerang import RingTriBoomerang

# 创建一个环形三角回旋镖结构
ring_tri_boomerang = RingTriBoomerang()
ring_tri_boomerang.show()  # 显示环形三角回旋镖结构
```

## 注意事项
- 代码中使用了 `gdsfactory` 库，确保在运行代码前已正确安装该库。
- 部分函数的参数有默认值，但在实际使用中可根据需要进行调整。
- 代码中的层定义（如 `LAYER.WG`）是基于 `LayerMapUserDef` 类的，可根据实际需求进行修改。
